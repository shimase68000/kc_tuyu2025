<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h2 id="event-title"></h2>

    <p id="tg000"></p>
    <p id="tg001"></p>
    <p id="tg002"></p>

    <p><b>【任務】</b></p>
    <p>　■Daily</p>
    <p id="tg100"></p>

    <p>　■Weekly</p>
    <p id="tg110"></p>
    <p id="tg111"></p>
    <p id="tg112"></p>

    <p>　■Monthly</p>
    <p id="tg120"></p>
    <p id="tg121"></p>
    <p id="tg122"></p>

<!--
    <p>　■単発</p>
    <p id="tg130"></p>
    <p id="tg131"></p>
-->
    <p id="tg200"></p>
    <p id="tg300"></p>

<!--
    <p><b>【報酬】</b></p>
    <p><span id="tg301"></span><span id="tg311"></span></p>
    <p><span id="tg302"></span><span id="tg312"></span></p>
    <p><span id="tg303"></span><span id="tg313"></span></p>
    <p><span id="tg304"></span><span id="tg314"></span></p>

    <p id="tg320"></p>
-->
    <script>
/////// イベント毎に変更 ↓↓↓ ここから ↓↓↓
        const ivent_name  = "艦これ 2025梅雨イベント てるてる坊主計算";
        const ivent_name2 = "梅雨イベント";

        const str_maxitem  = "◎最大てるてる坊主数";
        const str_myitem   = "◎現在のてるてる坊主数";
        const str_r_myitem = "◎てるてる坊主残数";
        const str_item     = "坊主";

        const key_myitem = "kcolle_tuyu2025_teruteru";

        const baseDate   = new Date("2025-05-30T05:00:00");  // イベント開始日時
        const finishDate = new Date("2025-06-30T11:00:00");  // イベント終了日時 仮置き
/////// イベント毎に変更 ↑↑↑ ここまで ↑↑↑

        const remindTime = 6 * (24 * 60 * 60 * 1000);      // リマインドの表示は終了6日前から
        const s_count  = 60;  // 時刻補正は60秒毎

        const color_maxitem = "#0000ff";
        const color_r_myitem = "#006000";
        const days = ["日曜日", "月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日"];

        // 日間任務
        const d_quest = [
            "[演習]【梅雨限定任務】海上護衛隊、雨中演習！", 1
        ];
        // 週間任務
        const w_quest = [
            "[出撃]【梅雨限定任務】雨の南西諸島防衛戦！", 2,
            "[出撃]【梅雨拡張任務】梅雨の海上護衛強化！2025", 3
        ];
        // 月間任務
        const m_quest = [
            "[出撃]【梅雨限定月間任務】西方海域統合作戦 2025", 4
        ];
        // 単発任務
        const s_quest = [
        ];
        // イベント報酬
        const item = [
        ];

        // タイトル設定
        document.title = ivent_name;
        document.getElementById('event-title').textContent = ivent_name;

        let prevDays = -1;
        let myitem = 0;
        let r_myitem = 0;
        let sum = 0;
        let item_count = Array(item.length / 3).fill(0);

        let t_count = 0;
        let currentDate = new Date();

        async function getCurrentDateTime() {
            try {
                const response = await fetch("https://www.timeapi.io/api/Time/current/zone?timeZone=Asia/Tokyo");
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                return new Date(data.dateTime);
            } catch (error) {
                console.error("Error fetching current date and time:", error);
                return new Date();
            }
        }

        async function calculateTimeDifference(targetDate) {
            if( --t_count < 0 ) {
                t_count = s_count;
                currentDate = await getCurrentDateTime();
            } else {
                currentDate = new Date(currentDate.getTime() + 1000);
            }
            return currentDate - targetDate;
        }

        async function main() {
            let diffMs = await calculateTimeDifference(baseDate);
            let diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            let diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            let diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            let diffSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);

            let diffMonths = (currentDate.getFullYear() - baseDate.getFullYear()) * 12;
            diffMonths += (currentDate.getMonth() - baseDate.getMonth() + 1);

            let days_adjust = (baseDate.getDay() + 6) % 7;
            let i_week = Math.floor((diffDays + days_adjust) / 7) + 1;
            let i_day = (currentDate.getDay() + 6) % 7 + 1;

            let tempDiff = finishDate - baseDate;
            if( diffMs >= tempDiff ) {
                let tempDays = diffDays;
                let tempHours = diffHours;
                let tempMinutes = diffMinutes;
                let tempSeconds = diffSeconds;

                diffDays = Math.floor(tempDiff / (1000 * 60 * 60 * 24));
                diffHours = Math.floor((tempDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                diffMinutes = Math.floor((tempDiff % (1000 * 60 * 60)) / (1000 * 60));
                diffSeconds = Math.floor((tempDiff % (1000 * 60)) / 1000);

                i_week = Math.floor((diffDays + days_adjust) / 7) + 1;

                document.querySelector("#tg000").innerHTML = `<b><font color="red">${ivent_name2}は ${diffDays + 1}日間開催され、終了しました。</font></b> (${tempDays}.${diffHours.toString().padStart(2,'0')}:${tempMinutes.toString().padStart(2,'0')}:${tempSeconds.toString().padStart(2,'0')})`
                document.querySelector("#tg001").innerHTML = "";
            } else {
                document.querySelector("#tg000").innerHTML = `${ivent_name2}開始から ${diffDays + 1}日目。(${diffDays}.${diffHours.toString().padStart(2,'0')}:${diffMinutes.toString().padStart(2,'0')}:${diffSeconds.toString().padStart(2,'0')})`
                document.querySelector("#tg001").innerHTML = `第${i_week}週の${i_day}日目（${days[i_day % 7]}）です。`;
            }

            let r_Date = finishDate - currentDate + 1000;
            if( r_Date <= remindTime && r_Date > 0 ) {
                r_Days = Math.floor(r_Date / (1000 * 60 * 60 * 24));
                r_Hours = Math.floor((r_Date % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                r_Minutes = Math.floor((r_Date % (1000 * 60 * 60)) / (1000 * 60));
                r_Seconds = Math.floor((r_Date % (1000 * 60)) / 1000);

                if( r_Days > 0 ) {
                    document.querySelector("#tg002").innerHTML = `<b><font color="red">イベント終了まで、あと ${r_Days}日と${r_Hours}時間${r_Minutes}分${r_Seconds.toString().padStart(2,'0')}秒 です。</font></b>`;
                } else {
                    document.querySelector("#tg002").innerHTML = `<b><font color="red">イベント終了まで、あと ${r_Hours}時間${r_Minutes}分${r_Seconds.toString().padStart(2,'0')}秒 です。</font></b>`;
                }
            } else {
                document.querySelector("#tg002").innerHTML = "";
            }

            if (diffDays !== prevDays) {
                prevDays = diffDays;
                sum = 0;

                // Daily 任務
                document.querySelector("#tg100").innerHTML = `　${d_quest[0]} : ${str_item}${d_quest[1]}個 ×${diffDays + 1} ⇒ <b>${d_quest[1] * (diffDays + 1)}個</b>`;
                sum += d_quest[1] * (diffDays + 1);

                // Weekly 任務
                w_quest.forEach((_, i) => {
                    if (i % 2 === 0) {
                        let name = w_quest[i];
                        let count = w_quest[i + 1];
                        document.querySelector(`#tg11${Math.floor(i / 2)}`).innerHTML = `　${name} : ${str_item}${count}個 ×${i_week} ⇒ <b>${count * i_week}個</b>`;
                        sum += count * i_week;
                    }
                });

                // Monthly 任務
                m_quest.forEach((_, i) => {
                    if (i % 2 === 0) {
                        let name = m_quest[i];
                        let count = m_quest[i + 1];
                        document.querySelector(`#tg12${Math.floor(i / 2)}`).innerHTML = `　${name} : ${str_item}${count}個 ×${diffMonths} ⇒ <b>${count * diffMonths}個</b>`;
                        sum += count * diffMonths;
                    }
                });

                // 単発 任務
                s_quest.forEach((_, i) => {
                    if (i % 2 === 0) {
                        let name = s_quest[i];
                        let count = s_quest[i + 1];
                        document.querySelector(`#tg13${Math.floor(i / 2)}`).innerHTML = `　${name} : ${str_item}${count}個 ⇒ <b>${count}個</b>`;
                        sum += count;
                    }
                });

                myitem = isLocalStorageAvailable() ? localStorage.getItem(key_myitem) || sum : sum;

                document.querySelector("#tg200").innerHTML = `<font color=${color_maxitem}>${str_maxitem}：<b>${sum}個</b></font>`;
            }

//            d_tg300();
        }

        function d_tg300() {
            if (isLocalStorageAvailable()) {
                localStorage.setItem(key_myitem, myitem);
            }

            do {
                r_myitem = myitem;
                document.querySelector("#tg300").innerHTML = `<font color=${color_maxitem}>${str_myitem}：
                    <b><button id="myitem_dec">ー</button>
                    <span id="myitem_sum">${myitem}</span>個
                    <button id="myitem_inc">＋</button></b></font>`;

                // 報酬計算
                let jj = -1;
                item.forEach((_, i) => {
                    if(i % 3 === 0) {
                        let j = Math.floor(i / 3);
                        let cost = item[i + 1];
                        r_myitem -= item_count[j] * cost;
                        document.querySelector(`#tg30${j + 1}`).innerHTML = `　●${item[i]} : 必要${str_item}数 ${cost}個　
                            <button id="item_dec${j}">ー</button>
                            <b><span id="item_count${j}">${item_count[j]}</span>回交換</b>
                            <button id="item_inc${j}">＋</button>　
                            <button id="item_dec${j}">ー</button>
                            <b><span id="item_count${j}">${item_count[j]}</span>回交換</b>
                            <button id="item_inc${j}">＋</button>`;
                        if(item_count[j] > 0) {
                            jj = j;
                            document.querySelector(`#tg31${j + 1}`).innerHTML = ` ⇒ <b>${item_count[j] * item[i+1]}個</b>消費`;
                        } else {
                            document.querySelector(`#tg31${j + 1}`).innerHTML = "";
                        }
                    }
                });

                if(r_myitem < 0 && jj >= 0) item_count[jj]--;

            } while( r_myitem < 0 );

            document.querySelector("#tg320").innerHTML = `<font color=${color_r_myitem}>${str_r_myitem}：<b>${r_myitem}個</b></font>`;
        }

        function isLocalStorageAvailable() {
            try {
                const testKey = "__test__";
                localStorage.setItem(testKey, "1");
                localStorage.removeItem(testKey);
                return true;
            } catch (e) {
                return false;
            }
        }

/***
        // ボタンのイベント処理
        document.addEventListener("click", (event) => {
            if (event.target.id === "myitem_inc" && myitem < sum) {
                myitem++;
            } else if (event.target.id === "myitem_dec" && myitem > 0) {
                myitem--;
            }

            for (let j = 0; j < item.length / 3; j++) {
                if (event.target.id === `item_inc${j}` && item_count[j] < item[j * 3 + 2] && r_myitem >= item[j * 3 + 1]) {
                    item_count[j]++;
                } else if (event.target.id === `item_dec${j}` && item_count[j] > 0) {
                    item_count[j]--;
                }
            }

            d_tg300();
        });
***/

        setInterval(main, 1000);
    </script>
</body>
</html>
